pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
function _init()
	-- randomize sprites by flag
	tiles={}
	possibles={{x=0,y=0},{x=0,y=0},{x=32,y=0},{x=32,y=0},{x=64,y=0},{x=64,y=0},{x=96,y=0},{x=96,y=0},{x=0,y=32},{x=0,y=32},{x=32,y=32},{x=32,y=32},{x=64,y=32},{x=64,y=32},{x=96,y=32},{x=96,y=32}}
	for i=1,16 do
		idx=flr(rnd(#possibles))+1
		add(tiles,possibles[idx],i)
		deli(possibles,idx)
	end
	selected = 1
	chosen={}
	matched={}
	time = 0
	frame = 0
	startdrawn = false
	pnboxx = -40
	pnboxy = 40
	pnboxw = 35
	pnboxh = 8
	pnboxdestx = 50
	pnboxdx = 0
	pnboxv = false
	boxmoving = false
	mode="game"
	mcheck=false
end

function _update60()
	if #matched == 16 then
		update_finish()
	else
		update_game()
	end
end

function update_game()
	if #chosen == 2 and not mcheck then
		checkmatch()
	end
	frame += 1
	if frame == 60 then
		frame = 0
		time += 1
	end
	if btnp(0) then
		selected -= 1
		if selected < 1 then
			selected = 16
		end
		while count(matched,selected) > 0 do
			selected -= 1
			if selected < 1 then
				selected = 16
			end
		end
	elseif btnp(1) then
		selected += 1
		if selected > 16 then
			selected = 1
		end
		while count(matched,selected) > 0 do
			selected += 1
			if selected > 16 then
				selected = 1
			end
		end
	elseif btnp(2) then
		selected -= 4
		if selected < 1 then
			selected += 16
		end
		while count(matched,selected) > 0 do
			selected -= 1
			if selected < 1 then
				selected = 16
			end
		end
	elseif btnp(3) then
		selected += 4
		if selected > 16 then
			selected -= 16
		end
		while count(matched,selected) > 0 do
			selected += 1
			if selected > 16 then
				selected = 1
			end
		end
	elseif btnp(5) then
		if #chosen == 2 then
			chosen = {}
			mcheck = false
		end
		add(chosen,selected)
	elseif btnp(4) and not boxmoving then
		boxmoving = true
	end
	if boxmoving then
		movebox()
	end
end

function update_finish()
	mode = "win"
	if btnp(5) then
		_init()
	end
end

function _draw()
	if mode == "win" then
		draw_finish()
	else
		draw_game()
	end
end

function draw_finish()
	cls()
	print("all tiles matched! win time: "..time.."s",1,61,7)
	print("press ‚ùé to play again!",20,71,7)
end

function draw_game()
	cls()
	palt(14,true)
	palt(0,false)
	line(0,0,127,0,7)
	line(0,32,127,32,7)
	line(0,64,127,64,7)
	line(0,96,127,96,7)
	line(0,127,127,127,7)
	line(0,0,0,127,7)
	line(32,0,32,127,7)
	line(64,0,64,127,7)
	line(96,0,96,127,7)
	line(127,0,127,127,7)
	if not startdrawn then
		idx=1
		for i=1,97,32 do
			for j=1,97,32 do
				tiles[idx].drawx = j
				tiles[idx].drawy = i
				sspr(0,64,31,31,j,i)
				idx += 1
			end
		end
	end
	for m=1,#matched do
		sspr(tiles[matched[m]].x,tiles[matched[m]].y,31,31,tiles[matched[m]].drawx,tiles[matched[m]].drawy)
	end
	for c=1,#chosen do
		sspr(tiles[chosen[c]].x,tiles[chosen[c]].y,31,31,tiles[chosen[c]].drawx,tiles[chosen[c]].drawy)
	end

	xoffset = (selected%4)-1
	if xoffset < 0 then
		xoffset = 3
	end
	line(xoffset*32,flr(selected*31/127)*32,xoffset*32,(flr(selected*31/127)*32)+31,8)
	line(xoffset*32,flr(selected*31/127)*32,(xoffset*32)+31,flr(selected*31/127)*32,8)
	line(xoffset*32,(flr(selected*31/127)*32)+31,(xoffset*32)+31,(flr(selected*31/127)*32)+31,8)
	line((xoffset*32)+31,flr(selected*31/127)*32,(xoffset*32)+31,(flr(selected*31/127)*32)+31,8)
	rectfill(pnboxx,pnboxy,pnboxx+pnboxw,pnboxy+pnboxh,0)
	line(pnboxx,pnboxy,pnboxx,pnboxy+pnboxh,7)
	line(pnboxx+pnboxw,pnboxy,pnboxx+pnboxw,pnboxy+pnboxh,7)
	line(pnboxx,pnboxy,pnboxx+pnboxw,pnboxy,7)
	line(pnboxx,pnboxy+pnboxh,pnboxx+pnboxw,pnboxy+pnboxh,7)
	print("time: "..time,pnboxx+2,pnboxy+2,7)
end

function movebox()
	if pnboxv then
		pnboxdx = -1.5
		pnboxdestx = -40
		pnboxx += pnboxdx
		if pnboxx < pnboxdestx then
			pnboxx = pnboxdestx
			pnboxv = false
			boxmoving = false
		end
	else
		pnboxdx = 1.5
		pnboxx += pnboxdx
		if pnboxx > pnboxdestx then
			pnboxx = pnboxdestx
			pnboxv = true
			boxmoving = false
		end
	end
end

function checkmatch()
	tile1 = tiles[chosen[1]]
	tile2 = tiles[chosen[2]]
	if tile1.x == tile2.x and tile1.y == tile2.y then
		add(matched,chosen[1])
		add(matched,chosen[2])
	end
	mcheck = true
end
__gfx__
ccccccccccccccccccccccccccccccccbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb22222222222222222222222222222222ffffffffffffffffffffffffffffffff
ccccccccccccccccccccccccccccccccbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb22222222222999999922222222222222ffffffffffffffffffffffffffffffff
ccccccccccccccccccccccccccccccccbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb22222222299222222222222222222222ffffffffffffffffffffffffffffffff
ccccccccccccccccccccccccccccccccbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb22222229922222222222229999999222ffffff3fffffffffffffffffffffffff
ccccccccccccccccccccccccccccccccbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb22222299222222222299999222222222ffffff33ffffffffffffffff33ffffff
ccccccccccccccccccccccccccccccccbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb22222922222222222992222222222222fffffff3ffffff33fffffff33fffffff
ccccccccccccccccccccccccccccccccbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb22222922222222229922222222222222ffffffff3ffffff3fffffff3ffffffff
ccccccccccccccccccccccccccccccccbbbbbbbbbbbbbbbbbb55555bbbbbbbbb22229222222222222299999999999922ffffffff3ffffff33fffff33ffffffff
ccccccccccccccccccccccccccccccccbbbbbb5555bbbbbbb55bbb5bbbbbbbbb22229222222222222222222222999922fffffffff3ffffff3ffff33fffffffff
ccccccccccccccccccccccccccccccccbbbbb55bb5bbbbbbb5bbbb55bbbbbbbb22229922222222222222222299922222ffffffffff3fffff33fff33fffffffff
ccccccccccccccccccccccccccccccccbbbbb55bb55bbbbb55bbbbb5bbbbbbbb22222992222222222222222992222222ffffffffff3ffffff3ff33ffffffffff
cccccccccccccccccccc88ccccccccccbbbbbb5bbb5bbbbb5bbbbb55bbbbbbbb22222299999999999222229222222222fffffffffff3fffff3f33fffffffffff
ccccccccc888ccccccc8888cccccccccbbbbbb5bbb5bbbbb5bbbbb5bbbbbbbbb22222222222222222999992222222222fffffffffff33ffff3f33fffffffffff
cccccccc88c88cccc88ccc8cccccccccbbbbbbbbbb55bbb55bbbbbbbbbbbbbbb22222222222222222299299922222222fffffffffffff33ff333ffffffffffff
ccccccc88ccc88cc88cccc88ccccccccbbbbbbbbbbb5bbb5bbbbbbbbbbbbbbbb22222222222222229922222999222222ffffffffffffff33333fffffffffffff
cccccc88ccccc8888cccccc8ccccccccbbbbbbbbbbb5bb55bbbbbbbbbbbbbbbb22222222222222292222222229222222ffffffffffffffff3fffffffffffffff
ccccc88cccccc8888cccccc88cccccccbbbbbbbbbbb5bb5bbbbbbbbbbbbbbbbb22222222222222922222222229222222fffffffffffffff3ffffffffffffffff
cccc88ccccccc8888ccccccc8cccccccbbbbbbbbbbb55b5bbbbbbbbbbbbbbbbb22222222222229222222222292222222ffffffffffffff3fffffffffffffffff
cc888ccccccccccccccccccc88ccccccbbbbbbbbbbbb555bbbbbbbbbbbbbbbbb22222222222292222222222292222222ffffffffffffff3fffffffffffffffff
cc8cccccccccccccccccccccc88cccccbbbbbbbbbbbb55bbbbbbbbbbbbbbbbbb22222222229922222222229922222222fffffffffffff3ffffffffffffffffff
ccccccccccccccccccccccccccccccccbbbbbbbbbbbbb5bbbbbbbbbbbbbbbbbb22222222992222222222292222222222fffffffffff33fffffffffffffffffff
ccccccccccccccccccccccccccccccccbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb22222299922222222229992222222222ffffffffff3fffffffffffffffffffff
ccccccccccccccccccccccccccccccccbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb22222992222222222292222222222222fffffffff3ffffffffffffffffffffff
ccccccccccccccccccccccccccccccccbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb22229922222222222922222222222222fffffffff3ffffffffffffffffffffff
ccccccccccccccccccccccccccccccccbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb22292222222222299222222222222222ffffffff3fffffffffffffffffffffff
ccccccccccccccccccccccccccccccccbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb22222222222222292222222222222222fffffff3ffffffffffffffffffffffff
ccccccccccccccccccccccccccccccccbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb22222222222229922222222222222222ffffff33ffffffffffffffffffffffff
ccccccccccccccccccccccccccccccccbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb22222222222292222222222222222222ffffff3fffffffffffffffffffffffff
ccccccccccccccccccccccccccccccccbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb22222222222992222222222222222222fffff33fffffffffffffffffffffffff
ccccccccccccccccccccccccccccccccbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb22222222299222222222222222222222ffffffffffffffffffffffffffffffff
ccccccccccccccccccccccccccccccccbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb22222222292222222222222222222222ffffffffffffffffffffffffffffffff
ccccccccccccccccccccccccccccccccbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb22222222222222222222222222222222ffffffffffffffffffffffffffffffff
dddddddddddddddddddddddddddddddd777777777777777777777777777777774444444444444444444444444444444455555555555555555555555555555555
dddddddddddddddddddddddddddddddd777777777777777777777777777777774444444444444444444444444444444455555555555555555555555555555555
dddddddddddddddddddddddddddddddd777777777777777777777777777777774444444444444444444444444444444455555555555555555555555555555555
dddddddddddddddddddddddddddddddd777777777777777777777777777777774444444444444444444444444444444455555555555555555555555555555555
dddddddddddddddddddddddddddddddd777777777777777777777777777777774444444444444444444444444444444455555555555555555555555555555555
dddddddddddddddddddddddddddddddd7777777777777777777777777777777744444444444cc4444444444444444444555555fffffffffffffffffffffffff5
dddddddddddddddddddddddddddddddd777777777777777770000000077777774444444444ccc4444444444444444444555555555555555555555555555555ff
dddddddddddddddddddddddddddddddd777700000000077777777777777777774444444444c4c44444444444444444445555555555555555555555555555fff5
dddddddddddddddddddddddddddddddd777777777777777777777777777777774444444444c4c4444444444444444444555555555555555555555555555f5555
ddddddddddddddddaaaadddddddddddd77777777777777777777777777777777444444444c44c444cc444444444444445555555555555555555555555ff55555
dddddddddddddaaaaddaaddddddddddd7777777777777777777777777777777744444444c444c444cc44444444444444555555555555555555555ffff5555555
dddddddddddaadddddddaadddddddddd7777777777777777777777777777777744c4444c4444c44c4c444444444444445555555555555555555ff55555555555
dddddddddaaddddddddddadddddddddd7777777777777777777707777777777744c444c44444cccc4c44cc444444444455555555555555fffff5555555555555
dddddddddadddddddddddadddddddddd7777777777777000000007777777777744c444c444444cc44c44cc4444444444555555555555ffffffff555555555555
ddddddddaaddddddddddddaddddddddd7777777777777777777777777777777744c44c4444444cc44c4c4c44cc444444555555555555555ff555555555555555
ddddddddadddddddddddddaddddddddd7777777777777777777777777777777744c4c44444444c444cc44c4ccc444444555555555555fff55555555555555555
dddddddaadddddddddddddaddddddddd7777777777777777777777777777777744ccc444444444444c444cc44c44444455555555555f55555555555555555555
dddddddaddddddddddddddaadddddddd7777777777777777777777777777777744cc44444444444444444c444c4c444455555555fff555555ff5555555555555
dddddddadddddddddddddddadddddddd777777777777777777777777777777774444444444444444444444444ccccccc55555555ffffffffff55555555555555
ddddddaddddddddddddddddadddddddd777777777777777777777777777777774444444444444444444444444c4c444c5555555555555fff5555555555555555
ddddddaddddddddddddddddadddddddd7777777777770007777777777777777744444444444444444444444444444444555555555555f5555555555555555555
ddddddaddddddddddddddddadddddddd77777700000077777777777777777777444444444444444444444444444444445555555555ff555f5555555555555555
ddddddaddddddddddddddddadddddddd77777777777777777777007777777777444444444444444444444444444444445555555555ffffff5555555555555555
ddddddaddddddddddddddddaaddddddd7777777777777777777770007777777744444444444444444444444444444444555555555555fffff555555555555555
ddddddadddddddddddddddddaddddddd7777777777777777777777700007777744444444444444444444444444444444555555555555ffffffff555555555555
ddddddadddddddddddddddddaddddddd77777777777777777777777777777777444444444444444444444444444444445555555555555555555fffff55555555
ddddddaddddddddddddddddddddddddd777777777777777777777777777777774444444444444444444444444444444455555555555555555555555ff5555555
dddddddddddddddddddddddddddddddd7777777777777777777777777777777744444444444444444444444444444444555555555555555555555555ff555555
dddddddddddddddddddddddddddddddd77777777777777777777777777777777444444444444444444444444444444445555555555555555555555555ffff555
dddddddddddddddddddddddddddddddd777777777777777777777777777777774444444444444444444444444444444455555555555555555555555555555555
dddddddddddddddddddddddddddddddd777777777777777777777777777777774444444444444444444444444444444455555555555555555555555555555555
dddddddddddddddddddddddddddddddd777777777777777777777777777777774444444444444444444444444444444455555555555555555555555555555555
66666666666666666666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666667676666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666676667666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666667666666676666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666676666666666766666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666667666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666676666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666667666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666766666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666766666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666766666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666766666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666766666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0101010102020202040404040808080801010101020202020404040408080808010101010202020204040404080808080101010102020202040404040808080810101010202020204040404080808080101010102020202040404040808080801010101020202020404040408080808010101010202020204040404080808080
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

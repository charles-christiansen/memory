pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
function _init()
	-- randomize sprites by flag
	tiles={}
	possibles={{x=0,y=0},{x=0,y=0},{x=32,y=0},{x=32,y=0},{x=64,y=0},{x=64,y=0},{x=96,y=0},{x=96,y=0},{x=0,y=32},{x=0,y=32},{x=32,y=32},{x=32,y=32},{x=64,y=32},{x=64,y=32},{x=96,y=32},{x=96,y=32}}
	for i=1,16 do
		idx=flr(rnd(#possibles))+1
		add(tiles,possibles[idx],i)
		deli(possibles,idx)
	end
	selected = 1
	chosen={}
	matched={}
	time = 0
	frame = 0
	startdrawn = false
	pnboxx = -40
	pnboxy = 40
	pnboxw = 35
	pnboxh = 8
	pnboxdestx = 50
	pnboxdx = 0
	pnboxv = false
	boxmoving = false
	mode="game"
	mcheck=false
end

function _update60()
	if #matched == 16 then
		update_finish()
	else
		update_game()
	end
end

function update_game()
	if #chosen == 2 and not mcheck then
		checkmatch()
	end
	frame += 1
	if frame == 60 then
		frame = 0
		time += 1
	end
	if btnp(0) then
		selected -= 1
		if selected < 1 then
			selected = 16
		end
		while count(matched,selected) > 0 do
			selected -= 1
			if selected < 1 then
				selected = 16
			end
		end
	elseif btnp(1) then
		selected += 1
		if selected > 16 then
			selected = 1
		end
		while count(matched,selected) > 0 do
			selected += 1
			if selected > 16 then
				selected = 1
			end
		end
	elseif btnp(2) then
		selected -= 4
		if selected < 1 then
			selected += 16
		end
		while count(matched,selected) > 0 do
			selected -= 1
			if selected < 1 then
				selected = 16
			end
		end
	elseif btnp(3) then
		selected += 4
		if selected > 16 then
			selected -= 16
		end
		while count(matched,selected) > 0 do
			selected += 1
			if selected > 16 then
				selected = 1
			end
		end
	elseif btnp(5) then
		if #chosen == 2 then
			chosen = {}
			mcheck = false
		end
		add(chosen,selected)
	elseif btnp(4) and not boxmoving then
		boxmoving = true
	end
	if boxmoving then
		movebox()
	end
end

function update_finish()
	mode = "win"
	if btnp(5) then
		_init()
	end
end

function _draw()
	if mode == "win" then
		draw_finish()
	else
		draw_game()
	end
end

function draw_finish()
	cls()
	print("all tiles matched! win time: "..time.."s",1,61,7)
	print("press ‚ùé to play again!",20,71,7)
end

function draw_game()
	cls()
	palt(14,true)
	palt(0,false)
	line(0,0,127,0,7)
	line(0,32,127,32,7)
	line(0,64,127,64,7)
	line(0,96,127,96,7)
	line(0,127,127,127,7)
	line(0,0,0,127,7)
	line(32,0,32,127,7)
	line(64,0,64,127,7)
	line(96,0,96,127,7)
	line(127,0,127,127,7)
	if not startdrawn then
		idx=1
		for i=1,97,32 do
			for j=1,97,32 do
				tiles[idx].drawx = j
				tiles[idx].drawy = i
				sspr(0,64,31,31,j,i)
				idx += 1
			end
		end
	end
	for m=1,#matched do
		sspr(tiles[matched[m]].x,tiles[matched[m]].y,31,31,tiles[matched[m]].drawx,tiles[matched[m]].drawy)
	end
	for c=1,#chosen do
		sspr(tiles[chosen[c]].x,tiles[chosen[c]].y,31,31,tiles[chosen[c]].drawx,tiles[chosen[c]].drawy)
	end

	xoffset = (selected%4)-1
	if xoffset < 0 then
		xoffset = 3
	end
	line(xoffset*32,flr(selected*31/127)*32,xoffset*32,(flr(selected*31/127)*32)+31,8)
	line(xoffset*32,flr(selected*31/127)*32,(xoffset*32)+31,flr(selected*31/127)*32,8)
	line(xoffset*32,(flr(selected*31/127)*32)+31,(xoffset*32)+31,(flr(selected*31/127)*32)+31,8)
	line((xoffset*32)+31,flr(selected*31/127)*32,(xoffset*32)+31,(flr(selected*31/127)*32)+31,8)
	rectfill(pnboxx,pnboxy,pnboxx+pnboxw,pnboxy+pnboxh,0)
	line(pnboxx,pnboxy,pnboxx,pnboxy+pnboxh,7)
	line(pnboxx+pnboxw,pnboxy,pnboxx+pnboxw,pnboxy+pnboxh,7)
	line(pnboxx,pnboxy,pnboxx+pnboxw,pnboxy,7)
	line(pnboxx,pnboxy+pnboxh,pnboxx+pnboxw,pnboxy+pnboxh,7)
	print("time: "..time,pnboxx+2,pnboxy+2,7)
end

function movebox()
	if pnboxv then
		pnboxdx = -1.5
		pnboxdestx = -40
		pnboxx += pnboxdx
		if pnboxx < pnboxdestx then
			pnboxx = pnboxdestx
			pnboxv = false
			boxmoving = false
		end
	else
		pnboxdx = 1.5
		pnboxx += pnboxdx
		if pnboxx > pnboxdestx then
			pnboxx = pnboxdestx
			pnboxv = true
			boxmoving = false
		end
	end
end

function checkmatch()
	tile1 = tiles[chosen[1]]
	tile2 = tiles[chosen[2]]
	if tile1.x == tile2.x and tile1.y == tile2.y then
		add(matched,chosen[1])
		add(matched,chosen[2])
	end
	mcheck = true
end
__gfx__
eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee555555555555555555555555555555554444444444444444444444444444444422222222222222222222222222222222
eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee555555555555555555555555555555554444444444444444444444444444444422222222222222222222222222222222
eeccccccccccccccccccccccccccccee55bbbbbbbbbbbbbbbbbbbbbbbbbbbb554422222222222000000222222222224422ff00000fffffffff000000ffffff22
eeccccccccccccccccccccccccccccee55bbbbbbbbbbbbbbbbbbbbbbbbbbbb554422222222200999999002222222224422f0333330ff00ff003333330000ff22
eeccccccccccccccccccccccccccccee55bbbbbbbbbbbbbbbbbbbbbbbbbbbb554422222220099999949990022222224422003333330033003333330333330f22
eeccccccccccccccccccccccccccccee55bbbbbbbbbbbbbbbbbbbbbbbbbbbb554422222209999999994999900222224422033333330333333333003033330f22
eecc0cccccccccccccccccccccc0ccee55bbbbbbbbbbbbbbbbbbbbbbbbbbbb554422222209499777779499990022224422033333333333333333330303333022
eec080cccccccccccccccccccc080cee55bbbbbbbbbbbbbbbbbbbbbbbbbbbb554422222209949770779949999022224422033003333333333333330330333022
ee08880cccccccccccccccccc08880ee55bbbbbbbbbbbbbbbbbbbbbbbbbbbb554422222209999700079994990222224422030033333333333033330333033022
ee080880cccccccccccccccc088080ee55bbbbbbbbbbbbbbbbbbbbbbbbbbbb554422222209499770779999902222224422f00333303333330303330033300f22
ee0800880cccccccccccccc0880080ee55bbbbbbb00bbbbbbbbbb00bbbbbbb554422222220949777779999022222224422f03333300333333030333033330f22
ee080c0880ccc000000ccc0880c080ee55bbbbbb0220bbbbbbbb0220bbbbbb554422222208094999999490222222224422f03330003333333003333303330f22
ee080c08880c08888880c08880c080ee55bbbbb022220bbbbbb022220bbbbb554422220080209999949949022222224422f03330333033333003333303330f22
ee080c08088080000088088080c080ee55bbbbb02bb2200000022bb20bbbbb554422208802220099994999902222224422ff0003333033033303333300330f22
eec0cc08008880777088880080cc0cee55bbbbb02b222022220222b20bbbbb554422080802222200999499990222224422ffff0333043040030333330f00ff22
eecccc080c088070708880c080ccccee55bbbbb02b202222222202b20bbbbb554422202022222222009949999022224422fff0333304044440303330ffffff22
eecccc080c088077708880c080ccccee55bbbbb0220b02077020b0220bbbbb554422222222222222220994999902224422fff03330044444400f000fffffff22
eeccccc0ccc0800000880ccc0cccccee55bbbbbb0220b270072b0220bbbbbb554422222222222222220999499022224422ffff030f04444440ffffffffffff22
eecccccccccc08888880ccccccccccee55bbbbbbb00b02700720b00bbbbbbb554422222222222222009499990222224422fffff0ff04444440ffffffffffff22
eeccccccccccc000000cccccccccccee55bbbbbbbbbb02077020bbbbbbbbbb554422222222222200999949902222224422ffffffff04444440ffffffffffff22
eeccccccccccccccccccccccccccccee55bbbbbbbbbb02200220bbbbbbbbbb554422222222220099949999022222224422ffffffff04444440ffffffffffff22
eeccccccccccccccccccccccccccccee55bbbbbbbbbbb022220bbbbbbbbbbb554422222222209999994990222222224422ffffffff04444440ffffffffffff22
eeccccccccccccccccccccccccccccee55bbbbbbbbbbb022220bbbbbbbbbbb554422222222099994999402222222224422ffffffff04444440ffffffffffff22
eeccccccccccccccccccccccccccccee55bbbbbbbbbbbb0220bbbbbbbbbbbb554422222222209999499990222222224422ffffffff04444440ffffffffffff22
eeccccccccccccccccccccccccccccee55bbbbbbbbbbbbb00bbbbbbbbbbbbb554422222222220009949999022222224422ffffffff04444440ffffffffffff22
eeccccccccccccccccccccccccccccee55bbbbbbbbbbbbbbbbbbbbbbbbbbbb554422222222222220009999902222224422ffffffff04444440ffffffffffff22
eeccccccccccccccccccccccccccccee55bbbbbbbbbbbbbbbbbbbbbbbbbbbb554422222222222222220999022222224422ffffff00444444400fffffffffff22
eeccccccccccccccccccccccccccccee55bbbbbbbbbbbbbbbbbbbbbbbbbbbb554422222222222222222099022222224422fffff0044444444400ffffffffff22
eeccccccccccccccccccccccccccccee55bbbbbbbbbbbbbbbbbbbbbbbbbbbb554422222222222222222209022222224422ffff044444444444440fffffffff22
eeccccccccccccccccccccccccccccee55bbbbbbbbbbbbbbbbbbbbbbbbbbbb554422222222222222222220022222224422fff04444444444444440ffffffff22
eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee555555555555555555555555555555554444444444444444444444444444444422222222222222222222222222222222
eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee555555555555555555555555555555554444444444444444444444444444444422222222222222222222222222222222
ffffffffffffffffffffffffffffffff3333333333333333333333333333333311111111111111111111111111111111bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb
ffffffffffffffffffffffffffffffff3333333333333333333333333333333311111111111111111111111111111111bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb
ffddddddddddddddddddddddddddddff3377777777777777777777777777773311444444444444444444444444444411bb5555555555555555555555555555bb
ffddddddddddddddddddddddddddddff3377777777777777777777777777773311444444444444444444444444444411bb5555555555555555555555555555bb
ffddddddddddddd00dddddddddddddff3377777777777777777777777777773311444440000000000000000000044411bb5555555000000000000005555555bb
ffdddddddddddd0770ddddddddddddff337777777777777777777777777777331144440ccccccccccccccccccc044411bb5555000ffffffffffffff0005555bb
ffddddddddddd078870dddddddddddff337700000000007777000000000077331144440cccccccccccccccccc0444411bb5550ffffffdddddddfffffff0555bb
ffdddddddddd07788770ddddddddddff337705558855507777055588555077331144440ccccccccccccccccc04444411bb550ffffffddfffffdddffffff055bb
ffddddddddddd077770dddddddddddff33770555885550777705558855507733114444400000000000000cc044444411bb550fffffffffffffffddfffff055bb
ffdddddddddddd0770ddddddddddddff3377000000000077770000000000773311444444444444444440cc0444444411bb5550fffffddddddffdddffff0555bb
ffddddddddddddd00dddddddddddddff337777777777777777777777777777331144444444444444440ccc0444444411bb5555000ffdffffddddfff0005555bb
ffddddddddddddddddddddddddddddff33777777777777777777777777777733114444444444444440ccc04444444411bb5555550ffdffffffffff00555555bb
ffddddddddddddd00dddddddddddddff3377777777777777777777777777773311444444444444440ccc044444444411bb555550fffdddddffffffff055555bb
ffdddddddddddd0990ddddddddddddff337777700077777777777770007777331144444444444440ccc0000044444411bb55550ffffffffddddffffff05555bb
ffddddddddddd009900dddddddddddff33777777000777777777770007777733114444444444440ccc00cccc04444411bb55550fffffffffffddfffff05555bb
ffdddddddddd099aa990ddddddddddff3377777770007777777770007777773311444444444440ccccccccccc0444411bb555550fffffffffffdffff055555bb
ffdddddddddd099aa990ddddddddddff3377777777000777777700077777773311444444444440ccccccc0ccc0444411bb55555500fffdddddddff00555555bb
ffddddddddd09aa99aa90dddddddddff3377777777700000000000777777773311444444444440cccc000ccc04444411bb5555555500ffdffffff005555555bb
ffddddddddd09aa99aa90dddddddddff3377777777770000000000777777773311444444444444000040ccc044444411bb55555550ffffddfffffff0555555bb
ffdddddddd0aa99aa99aa0ddddddddff337777777777708888880777777777331144444444444444440ccc0444444411bb5555550ffffffdddffffff055555bb
ffdddddddd0aa99aa99aa0ddddddddff33777777777770088880077777777733114444444444444440ccc04444444411bb5555550ffffffffdddffff055555bb
ffddddddd0999aa99aa9990dddddddff3377777777777700880077777777773311444444444444440ccc044444444411bb55555550fffffffffdfff0555555bb
ffddddddd0999aa99aa9990dddddddff337777777777777000077777777777331144444444444440ccc0444444444411bb5555555500fffffddff005555555bb
ffdddddd099aa99aa99aa990ddddddff33777777777777777777777777777733114444444444440ccc04444444444411bb5555555550ffddddfff055555555bb
ffdddddd099aa99aa99aa990ddddddff3377777777777777777777777777773311444444444440ccc044444444444411bb555555550fffdfffffff05555555bb
ffddddd09aa99aa99aa99aa90dddddff337777777777777777777777777777331144444444440ccc0444444444444411bb555555550fffdddfffff05555555bb
ffddddd09aa99aa99aa99aa90dddddff33777777777777777777777777777733114444444440cc004444444444444411bb5555555550ffffdffff055555555bb
ffdddd0aa99aa99aa99aa99aa0ddddff3377777777777777777777777777773311444444440cc0444444444444444411bb555555555500fffff00555555555bb
ffdddd0aa99aa99aa99aa99aa0ddddff337777777777777777777777777777331144444440cc04444444444444444411bb5555555555550fff055555555555bb
ffdddd00000000000000000000ddddff3377777777777777777777777777773311444444440044444444444444444411bb5555555555555000555555555555bb
ffffffffffffffffffffffffffffffff3333333333333333333333333333333311111111111111111111111111111111bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb
ffffffffffffffffffffffffffffffff3333333333333333333333333333333311111111111111111111111111111111bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb
55555555555555555555555555555555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555555555555555555555555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55666666666666666666666666666655000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55666666666666666666666666666655000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55666666666667777766666666666655000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55666666666677777777666666666655000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55666666666777766777766666666655000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55666666666776666666776666666655000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55666666666776666666776666666655000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55666666666776666666776666666655000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55666666666666666666776666666655000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55666666666666666666776666666655000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55666666666666666666776666666655000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55666666666666666667776666666655000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55666666666666666677766666666655000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55666666666666666777666666666655000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55666666666666677776666666666655000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55666666666666777766666666666655000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55666666666666777666666666666655000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55666666666666776666666666666655000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55666666666666776666666666666655000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55666666666666776666666666666655000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55666666666666776666666666666655000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55666666666666776666666666666655000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55666666666666776666666666666655000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55666666666666666666666666666655000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55666666666666776666666666666655000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55666666666666776666666666666655000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55666666666666666666666666666655000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55666666666666666666666666666655000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555555555555555555555555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555555555555555555555555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
